---

- name: launch sish container
  docker_container:
    name: sish
    image: "antoniomika/sish:{{ global.sish.tag }}"
    restart_policy: unless-stopped
    hostname: "{{ inventory_hostname }}"
    network_mode: host
    command: >-
      --ssh-address=:{{ global.sish.sshAddress }}
      --http-address=:{{ global.sish.httpAddress }}
      --https-address=:{{ global.sish.httpsAddress }}
      --https=true
      --https-certificate-directory=/ssl
      --https-ondemand-certificate=true
      --authentication=true
      --authentication-password=""
      --authentication-keys-directory=/pubkeys
      --private-key-location=/keys/ssh_key
      --private-key-passphrase={{ global.sish.privateKeyPassphrase }}
      --bind-random-ports=false
      --bind-random-subdomains=false
      --domain={{ global.sish.domain }}
      --idle-connection-timeout=600s
    volumes:
    - "~/sish/ssl:/ssl"
    - "~/sish/keys:/keys"
    - "~/sish/pubkeys:/pubkeys"
